# CAP与BASE

## CAP

* Consistency(一致性)：即更新操作成功并返回客户端后，所有节点在同一时间的数据完全一致
* Availability(可用性), 好的响应性能 ：即服务一直可用，而且是正常响应时间。好的可用性主要是指系统能够很好的为用户服务，不出现用户操作失败或者访问超时等用户体验不好的情况
* Partition tolerance(分区容忍性) 可靠性：即分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务



* 关系型数据库的ACID模型拥有 CA，但是很难进行分区（P）



**分区容忍性：**在满足分区容错性的分布式系统，只能在一致性和可用性两者中，选择其中一个。因为分区容忍性保障在某个节点发生故障时（数据不能同步了），整个系统仍能对外提供服务。如果保障一致性的话，则必须等待着个节点恢复数据同步，那么就失去了可用性

**CA without P**：如果不要求P（不允许分区），则C（强一致性）和A（可用性）是可以保证的。但放弃P的同时也就意味着放弃了系统的扩展性，也就是分布式节点受限，没办法部署子节点，这是违背分布式系统设计的初衷的。传统数据库用这个。

**CP without A：**如果不要求A（可用），相当于每个请求都需要在Server之间强一致，而P（分区）会导致同步时间无限延长(也就是等待数据同步完才能正常访问服务)，如此CP也是可以保证的。很多传统的数据库分布式事务都属于这种模式

**AP wihtout C：**要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。现在众多的NoSQL都属于此类，如redis,mongdb等



**如果你关注的是一致性，那么您就需要处理因为系统不可用而导致的操作失败的情况，而如果您关注的是可用性，那么您应该知道系统的read操作可能不能精确的读取到write操作写入的最新值。**



一般分布式系统必须满足P，这是分布式的特性决定的，必须要有的可靠性，所以只能在C/A中选举取了，拿银行的转账系统来说，涉及到金钱的对于数据一致性不能做出一丝的让步，C必须保证，出现网络故障的话，宁可停止服务



## BASE思想的主要实现有

* 按功能划分数据库 

* sharding碎片 (数据库水平扩展)



| **选    择** | **说    明**                                                 |
| ------------ | ------------------------------------------------------------ |
| CA           | 放弃分区容错性，加强一致性和可用性，其实就是传统的单机数据库的选择 |
| AP           | 放弃一致性（这里说的一致性是强一致性），追求分区容错性和可用性，这是很多分布式系统设计时的选择，例如很多NoSQL系统就是如此 |
| CP           | 放弃可用性，追求一致性和分区容错性，基本不会选择，网络问题会直接让整个系统不可用 |

参考：

https://www.cnblogs.com/szlbm/p/5588543.html

https://blog.csdn.net/xiaqunfeng123/article/details/51688974

https://blog.csdn.net/u013613428/article/details/55259924

https://blog.csdn.net/yeyazhishang/article/details/80758354

